Object.defineProperty(exports, "__esModule", { value: true });
var result_1 = require("./result");
var BasicCanceler = /** @class */ (function () {
    function BasicCanceler() {
        var _this = this;
        this._fns = [];
        this._push = function (owner, fn) { return _this._fns.push([owner, fn]); };
        this._remove = function (owner) { return _this._fns = _this._fns.filter(function (f) { return f[0] != owner; }); };
        this.cancel = function () { _this._fns.forEach(function (t) { return t[1](); }); _this._fns = []; };
    }
    BasicCanceler.prototype.add = function (promise) {
        var _this = this;
        var thiz = this;
        var cancelled = false;
        this._push(thiz, function () { return cancelled = true; });
        return new Promise(function (resolve, reject) {
            promise.then(function (val) { return cancelled ? _this._remove(thiz) : resolve(val); }, function (error) { return cancelled ? _this._remove(thiz) : reject(error); });
        });
    };
    ;
    BasicCanceler.prototype.add_to = function (promise) { return result_1.to(promise); };
    ;
    return BasicCanceler;
}());
;
exports.createCanceler = function () { return new BasicCanceler(); };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FuY2VsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi90b29scy9jYW5jZWxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsbUNBQXNDO0FBUXRDO0lBQUE7UUFBQSxpQkFjQztRQWJTLFNBQUksR0FBd0IsRUFBRSxDQUFDO1FBQ3ZDLFVBQUssR0FBRyxVQUFDLEtBQVUsRUFBRSxFQUFjLElBQUssT0FBQSxLQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUEzQixDQUEyQixDQUFDO1FBQ3BFLFlBQU8sR0FBRyxVQUFDLEtBQVUsSUFBSyxPQUFBLEtBQUksQ0FBQyxJQUFJLEdBQUcsS0FBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxFQUFiLENBQWEsQ0FBQyxFQUFoRCxDQUFnRCxDQUFDO1FBVTNFLFdBQU0sR0FBRyxjQUFRLEtBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQU4sQ0FBTSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQTtJQUNwRSxDQUFDO0lBVkMsMkJBQUcsR0FBSCxVQUFPLE9BQW1CO1FBQTFCLGlCQU9DO1FBTkMsSUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxjQUFNLE9BQUEsU0FBUyxHQUFHLElBQUksRUFBaEIsQ0FBZ0IsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxPQUFPLENBQUksVUFBQyxPQUFPLEVBQUUsTUFBTTtZQUNwQyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUEsR0FBRyxJQUFJLE9BQUEsU0FBUyxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQTdDLENBQTZDLEVBQUUsVUFBQSxLQUFLLElBQUksT0FBQSxTQUFTLENBQUMsQ0FBQyxDQUFDLEtBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBOUMsQ0FBOEMsQ0FBQyxDQUFDO1FBQzlILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUFBLENBQUM7SUFDRiw4QkFBTSxHQUFOLFVBQVUsT0FBbUIsSUFBSSxPQUFPLFdBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFBQSxDQUFDO0lBRXpELG9CQUFDO0FBQUQsQ0FBQyxBQWRELElBY0M7QUFBQSxDQUFDO0FBRVcsUUFBQSxjQUFjLEdBQUcsY0FBTSxPQUFBLElBQUksYUFBYSxFQUFFLEVBQW5CLENBQW1CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBSZXN1bHQsIHRvIH0gZnJvbSAnLi9yZXN1bHQnO1xuXG5pbnRlcmZhY2UgQ2FuY2VsZXIge1xuICBhZGQ6IDxULCBfID0gbmV2ZXI+KHByb21pc2U6IFByb21pc2U8VD4pID0+IFByb21pc2U8VD47XG4gIGFkZF90bzogPFQsIF8gPSBuZXZlcj4ocHJvbWlzZTogUHJvbWlzZTxUPikgPT4gUHJvbWlzZTxSZXN1bHQ8VD4+O1xuICBjYW5jZWwoKTogdm9pZDtcbn1cblxuY2xhc3MgQmFzaWNDYW5jZWxlciBpbXBsZW1lbnRzIENhbmNlbGVyIHtcbiAgcHJpdmF0ZSBfZm5zOiBbYW55LCAoKSA9PiB2b2lkXVtdID0gW107XG4gIF9wdXNoID0gKG93bmVyOiBhbnksIGZuOiAoKSA9PiB2b2lkKSA9PiB0aGlzLl9mbnMucHVzaChbb3duZXIsIGZuXSk7XG4gIF9yZW1vdmUgPSAob3duZXI6IGFueSkgPT4gdGhpcy5fZm5zID0gdGhpcy5fZm5zLmZpbHRlcihmID0+IGZbMF0gIT0gb3duZXIpO1xuICBhZGQ8VD4ocHJvbWlzZTogUHJvbWlzZTxUPikge1xuICAgIGNvbnN0IHRoaXogPSB0aGlzO1xuICAgIGxldCBjYW5jZWxsZWQgPSBmYWxzZTtcbiAgICB0aGlzLl9wdXNoKHRoaXosICgpID0+IGNhbmNlbGxlZCA9IHRydWUpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxUPigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBwcm9taXNlLnRoZW4odmFsID0+IGNhbmNlbGxlZCA/IHRoaXMuX3JlbW92ZSh0aGl6KSA6IHJlc29sdmUodmFsKSwgZXJyb3IgPT4gY2FuY2VsbGVkID8gdGhpcy5fcmVtb3ZlKHRoaXopIDogcmVqZWN0KGVycm9yKSk7XG4gICAgfSk7XG4gIH07XG4gIGFkZF90bzxUPihwcm9taXNlOiBQcm9taXNlPFQ+KSB7IHJldHVybiB0byhwcm9taXNlKTsgfTtcbiAgY2FuY2VsID0gKCkgPT4geyB0aGlzLl9mbnMuZm9yRWFjaCh0ID0+IHRbMV0oKSk7IHRoaXMuX2ZucyA9IFtdOyB9XG59O1xuXG5leHBvcnQgY29uc3QgY3JlYXRlQ2FuY2VsZXIgPSAoKSA9PiBuZXcgQmFzaWNDYW5jZWxlcigpOyJdfQ==