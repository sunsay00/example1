Object.defineProperty(exports, "__esModule", { value: true });
exports.createGetter = function (p, onReady) {
    var ready = false;
    var outbox = [];
    var result;
    var ret = {
        current: function () { return result; },
        promise: function () { return new Promise(function (yes, no) {
            if (!ready) {
                ready = true;
                p.then(function (r) {
                    result = r;
                    var o = outbox;
                    outbox = [];
                    o.forEach(function (fn) { return fn(r); });
                    onReady && onReady(r);
                }).catch(function (err) {
                    console.error(err);
                    no(err);
                });
            }
            result != undefined ? yes(result) : outbox.push(yes);
        }); },
    };
    return ret;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlZ2V0dGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vdG9vbHMvY3JlYXRlZ2V0dGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFLYSxRQUFBLFlBQVksR0FBRyxVQUFJLENBQWEsRUFBRSxPQUF3QjtJQUNyRSxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDbEIsSUFBSSxNQUFNLEdBQXlCLEVBQUUsQ0FBQztJQUN0QyxJQUFJLE1BQXFCLENBQUM7SUFDMUIsSUFBTSxHQUFHLEdBQUc7UUFDVixPQUFPLEVBQUUsY0FBTSxPQUFBLE1BQU0sRUFBTixDQUFNO1FBQ3JCLE9BQU8sRUFBRSxjQUFNLE9BQUEsSUFBSSxPQUFPLENBQUksVUFBQyxHQUFHLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsS0FBSyxFQUFFO2dCQUNWLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQ2IsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLENBQUM7b0JBQ04sTUFBTSxHQUFHLENBQUMsQ0FBQztvQkFDWCxJQUFNLENBQUMsR0FBRyxNQUFNLENBQUM7b0JBQ2pCLE1BQU0sR0FBRyxFQUFFLENBQUM7b0JBQ1osQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFBLEVBQUUsSUFBSSxPQUFBLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBTCxDQUFLLENBQUMsQ0FBQztvQkFDdkIsT0FBTyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDeEIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUEsR0FBRztvQkFDVixPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO29CQUNuQixFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ1YsQ0FBQyxDQUFDLENBQUM7YUFDSjtZQUNELE1BQU0sSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2RCxDQUFDLENBQUMsRUFmYSxDQWViO0tBQ0gsQ0FBQztJQUNGLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgR2V0dGVyPFI+ID0ge1xuICBwcm9taXNlOiAoKSA9PiBQcm9taXNlPFI+LFxuICBjdXJyZW50OiAoKSA9PiBSIHwgdW5kZWZpbmVkLFxufTtcblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUdldHRlciA9IDxSPihwOiBQcm9taXNlPFI+LCBvblJlYWR5PzogKHI6IFIpID0+IHZvaWQpOiBHZXR0ZXI8Uj4gPT4ge1xuICBsZXQgcmVhZHkgPSBmYWxzZTtcbiAgbGV0IG91dGJveDogKChyZXQ6IFIpID0+IHZvaWQpW10gPSBbXTtcbiAgbGV0IHJlc3VsdDogUiB8IHVuZGVmaW5lZDtcbiAgY29uc3QgcmV0ID0ge1xuICAgIGN1cnJlbnQ6ICgpID0+IHJlc3VsdCxcbiAgICBwcm9taXNlOiAoKSA9PiBuZXcgUHJvbWlzZTxSPigoeWVzLCBubykgPT4ge1xuICAgICAgaWYgKCFyZWFkeSkge1xuICAgICAgICByZWFkeSA9IHRydWU7XG4gICAgICAgIHAudGhlbihyID0+IHtcbiAgICAgICAgICByZXN1bHQgPSByO1xuICAgICAgICAgIGNvbnN0IG8gPSBvdXRib3g7XG4gICAgICAgICAgb3V0Ym94ID0gW107XG4gICAgICAgICAgby5mb3JFYWNoKGZuID0+IGZuKHIpKTtcbiAgICAgICAgICBvblJlYWR5ICYmIG9uUmVhZHkocik7XG4gICAgICAgIH0pLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgIG5vKGVycik7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmVzdWx0ICE9IHVuZGVmaW5lZCA/IHllcyhyZXN1bHQpIDogb3V0Ym94LnB1c2goeWVzKTtcbiAgICB9KSxcbiAgfTtcbiAgcmV0dXJuIHJldDtcbn07XG4iXX0=